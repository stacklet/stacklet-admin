version: 0.2

env:
  shell: bash
  variables:
    JUST_VERSION: "1.13.0"
    POETRY_VERSION: "1.5.1"

phases:
  install:
    runtime-versions:
      python: 3.9
    commands:
      - curl --proto '=https' --tlsv1.2 -sSf https://just.systems/install.sh | bash -s -- --tag $JUST_VERSION --to /usr/local/bin
      - pip install pip --upgrade
      - curl -sSL https://install.python-poetry.org | python3 - --version $POETRY_VERSION
      - export PATH=$PATH:$HOME/.local/bin
      - apt-get update -y
      - apt-get install -y chrpath libfuse2 patchelf
  build:
    on-failure: ABORT
    commands:
      - .build/binaries.sh
  post_build:
    commands:
      - cat /release/installer.cfg
